
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Multiple resources, registrations with devise, STI and single sign sign on - Fun On Rails</title>
  <meta name="author" content="sandipransing">

  
  <meta name="description" content="Devise handles authentication, authorization part inside rails application quite easily and its customizable too. One can always customize default &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://sandipransing.github.io/2011/12/multiple-resources-registrations-with">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Fun On Rails" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
  

</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Fun On Rails</a></h1>
  
    <h2>Journal of a Web Developer #ruby #rails #JS</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:sandipransing.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Multiple Resources, Registrations With Devise, STI and Single Sign Sign On</h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-12-22T02:51:00+05:30" pubdate data-updated="true">Dec 22<span>nd</span>, 2011</time>
        
      </p>
    
  </header>


<div class="entry-content"><div class='post'>
Devise handles authentication, authorization part inside rails application quite easily and its customizable too. One can always customize default devise configurations. <br/> This Post will show how to manage multiple resources (like admin, staff, employees, guests etc.) through devise and STI with individual registrations process but login section will be the same for all. <br/><pre class=ruby># Gemfile gem 'devise' </pre><br/> <pre class=ruby># console bundle install rails g devise_install rails g devise User rake db:migrate rake routes </pre><br/><pre class=ruby># User model class User < ActiveRecord::Base   # Include default devise modules. Others available are:   # :token_authenticatable, :lockable, :timeoutable, :confirmable and :activatable   devise :database_authenticatable, :registerable,          :recoverable, :rememberable, :trackable, :validatable    # Setup accessible (or protected) attributes for your model   attr_accessible :email, :password, :password_confirmation end  ## Single Table Inheritance # Admin model class Admin < User end  # Staff class Staff < User end  # Employee class Employee < User end  # Guest class Guest < User end </pre><br/> <pre class=ruby># routes devise_for :users, :skip => :registrations devise_for :admins, :skip => :sessions devise_for :staffs, :skip => :sessions devise_for :employees, :skip => :sessions devise_for :guests, :skip => :sessions </pre><br/> <pre class=ruby># customizing default login/logout routes, views, actions devise_for :users, :controller => {:sessions  => 'sessions'}, :skip => [:sessions, :registrations] do     delete '/logout', :to => 'sessions#destroy', :as => :destroy_user_session     get '/login', :to => 'sessions#new', :as => :new_user_session     post '/login', :to => 'sessions#create', :as => :user_session end  # app/controllers/sessions_controller class SessionsController < Devise::SessionsController end </pre><br/><pre class=ruby>## overriding default after sign in path # app/controller/application_controller.rb class ApplicationController < ActionController::Base   protect_from_forgery   helper_method :account_url   def account_url     return new_user_session_url unless user_signed_in?     case current_user.class.name     when 'Customer'       edit_customer_registration_url     when 'Admin'       edit_home_page_section_url     else       root_url     end if user_signed_in?   end end  # app/controllers/sessions_controller.rb  class SessionsController < Devise::SessionsController    def after_sign_in_path_for(resource)     stored_location_for(resource) || account_url   end end </pre><br/> <pre class=ruby>## Changing default login field email to username # config/initializers/devise.rb  config.authentication_keys = [ :username ]  # app/models/user.rb   validates :username, :presence => true,      :uniqueness => {:allow_blank => true},     :format => {:with => /^\w+[\w\s:?']+$/i, :allow_blank => true}    def email_required?     false   end  </pre><br/>Adding devise authentication and authorization helper methods for above resources. <a href="http://www.funonrails.com/2011/12/dynamic-methods-inside-ruby-classes.html">read more here</a></div>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">sandipransing</span></span>

      








  


<time datetime="2011-12-22T02:51:00+05:30" pubdate data-updated="true">Dec 22<span>nd</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/devise/'>devise</a>, <a class='category' href='/blog/categories/inheritance/'>inheritance</a>, <a class='category' href='/blog/categories/rails-3/'>rails 3</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://sandipransing.github.io/2011/12/multiple-resources-registrations-with/" data-via="sandipransing" data-counturl="http://sandipransing.github.io/2011/12/multiple-resources-registrations-with/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2011/11/rails-311-haml-sass-jquery-coffee-rails/" title="Previous Post: rails 3.1.1 haml sass jquery coffee-rails devise twitter-bootstrap railroady heroku">&laquo; rails 3.1.1 haml sass jquery coffee-rails devise twitter-bootstrap railroady heroku</a>
      
      
        <a class="basic-alignment right" href="/2011/12/getting-assets-working-on-heroku/" title="Next Post: Getting assets pipeline working on heroku">Getting assets pipeline working on heroku &raquo;</a>
      
    </p>
  </footer>
</article>


</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2014/02/migrating-from-blogger-to-octopress/">Migrating from blogger to octopress</a>
      </li>
    
      <li class="post">
        <a href="/2014/02/writing-octopress-blog-posts-using-markdown/">Writing Octopress blog posts using markdown</a>
      </li>
    
      <li class="post">
        <a href="/2014/02/octopress-powered-and-github-hosted-blog/">Getting started: Octopress powered and Github hosted blog</a>
      </li>
    
      <li class="post">
        <a href="/2012/10/dynamic-conditions-to-rails-associations/">Dynamic conditions to rails associations</a>
      </li>
    
      <li class="post">
        <a href="/2012/04/upgrading-from-rails-21x-to-rails-2311/">Upgrading from Rails 2.1.x to Rails 2.3.11</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/sandipransing">@sandipransing</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'sandipransing',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - sandipransing -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> | Themed with <a href="https://github.com/lucaslew/whitespace">Whitespace</a></span>
</p>

</footer>
  








  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
