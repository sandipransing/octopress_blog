
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>csv file import / export in rails 3 - Fun On Rails</title>
  <meta name="author" content="sandipransing">

  
  <meta name="description" content="CSV (comma separated values) files are frequently used to import/export data. In rails 3, FasterCSV comes as default and below is the way to upload &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://sandipransing.github.io/2012/01/csv-file-importexport-in-rails-3">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Fun On Rails" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
  

</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Fun On Rails</a></h1>
  
    <h2>Journal of a Web Developer #ruby #rails #JS</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:sandipransing.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Csv File Import / Export in Rails 3</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-27T14:28:00+05:30" pubdate data-updated="true">Jan 27<span>th</span>, 2012</time>
        
      </p>
    
  </header>


<div class="entry-content"><div class='post'>
CSV (comma separated values) files are frequently used to import/export data. <br/>In rails 3, FasterCSV comes as default and below is the way to upload csv files inside rails applications. The code below will also show you how to generate csv in memory, parse on csv data, skip header, iterate over records, save records inside db, export upload error file and many more. <br/>First, View to upload file <br/><code>= form_tag upload_url, :multipart => true do   %label{:for => "file"} File to Upload   = file_field_tag "file"   = submit_tag </code>Assume upload_url maps to import action of customers controller <br/>Controller code <br/><code>class CustomersController < ApplicationController     [...]    def import     if request.post? && params[:file].present?       infile = params[:file].read       n, errs = 0, []        CSV.parse(infile) do |row|         n += 1         # SKIP: header i.e. first row OR blank row         next if n == 1 or row.join.blank?         # build_from_csv method will map customer attributes &          # build new customer record         customer = Customer.build_from_csv(row)         # Save upon valid          # otherwise collect error records to export         if customer.valid?           customer.save         else           errs << row         end       end       # Export Error file for later upload upon correction       if errs.any?         errFile ="errors_#{Date.today.strftime('%d%b%y')}.csv"         errs.insert(0, Customer.csv_header)         errCSV = CSV.generate do |csv|           errs.each {|row| csv << row}         end         send_data errCSV,           :type => 'text/csv; charset=iso-8859-1; header=present',           :disposition => "attachment; filename=#{errFile}.csv"       else         flash[:notice] = I18n.t('customer.import.success')         redirect_to import_url #GET       end     end   end   [...] end </code>Customer model <br/><code>class Customer < ActiveRecord::Base   scope :active, where(:active => true)   scope :latest, order('created_at desc')      def self.csv_header     "First Name,Last Name,Email,Phone,Mobile, Address, FAX, City".split(',')   end      def self.build_from_csv(row)     # find existing customer from email or create new     cust = find_or_initialize_by_email(row[2])     cust.attributes ={:first_name => row[0],       :last_name => row[1],       :email => row[3],       :phone => row[4],       :mobile => row[5],       :address => row[6],       :fax => row[7],       :city => row[8]}     return cust   end      def to_csv     [first_name, last_name, email, phone, mobile, address, fax, city]   end end </code><br/>Export customer records in CSV format<br/>Below code loads customer records from database then generate csv_data inside memory and  exports data to browser using send_data method.<br/>Note: As we are not writing on file system hence code can easily work heroku. <code>  def export     # CRITERIA : to select customer records     #=> Customer.active.latest.limit(100)     custs = Customer.limit(10)     filename ="customers_#{Date.today.strftime('%d%b%y')}"     csv_data = FasterCSV.generate do |csv|       csv << Customer.csv_header       custs.each do |c|          csv << c.to_csv       end      end      send_data csv_data,       :type => 'text/csv; charset=iso-8859-1; header=present',       :disposition => "attachment; filename=#{filename}.csv"   end  </code></div>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">sandipransing</span></span>

      








  


<time datetime="2012-01-27T14:28:00+05:30" pubdate data-updated="true">Jan 27<span>th</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/faster-csv/'>faster-csv</a>, <a class='category' href='/blog/categories/rails-3/'>rails 3</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://sandipransing.github.io/2012/01/csv-file-importexport-in-rails-3" data-via="sandipransing" data-counturl="http://sandipransing.github.io/2012/01/csv-file-importexport-in-rails-3" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2012/01/mongoid-embededin-and-array-field" title="Previous Post: Mongoid embeded_in and Array field management">&laquo; Mongoid embeded_in and Array field management</a>
      
      
        <a class="basic-alignment right" href="/2012/01/puts-tos-and-inspect-on-ruby-object" title="Next Post: puts, to_s and inspect on ruby object">puts, to_s and inspect on ruby object &raquo;</a>
      
    </p>
  </footer>
</article>


</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2014/02/migrating-from-blogger-to-octopress">Migrating from blogger to octopress</a>
      </li>
    
      <li class="post">
        <a href="/2014/02/writing-octopress-blog-posts-using-markdown">Writing Octopress blog posts using markdown</a>
      </li>
    
      <li class="post">
        <a href="/2014/02/octopress-powered-and-github-hosted-blog">Getting started: Octopress powered and Github hosted blog</a>
      </li>
    
      <li class="post">
        <a href="/2012/10/dynamic-conditions-to-rails-associations">Dynamic conditions to rails associations</a>
      </li>
    
      <li class="post">
        <a href="/2012/04/upgrading-from-rails-21x-to-rails-2311">Upgrading from Rails 2.1.x to Rails 2.3.11</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/sandipransing">@sandipransing</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'sandipransing',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - sandipransing -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> | Themed with <a href="https://github.com/lucaslew/whitespace">Whitespace</a></span>
</p>

</footer>
  








  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
