
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>using thinking sphinx search in rails app - Fun On Rails</title>
  <meta name="author" content="sandipransing">

  
  <meta name="description" content="I am using acts_as_ferret and ferret server as of now with my rails application and it just works fine for me. The ONLY problem is performance as it &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://sandipransing.github.io/2010/04/using-thinking-sphinx-search-in-rails">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Fun On Rails" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
  

</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Fun On Rails</a></h1>
  
    <h2>Journal of a Web Developer #ruby #rails #JS</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:sandipransing.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Using Thinking Sphinx Search in Rails App</h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-04-12T19:07:00+05:30" pubdate data-updated="true">Apr 12<span>th</span>, 2010</time>
        
      </p>
    
  </header>


<div class="entry-content"><div class='post'>
I am using <b>acts_as_ferret</b> and ferret server as of now with my rails application and it just works fine for me. The ONLY problem is <b>performance</b> as it takes a lot time to build index and to rebuild index when it gets screwed up and that&#8217;s where <b>sphinx rocks</b>! <br />To get started with thinking sphinx you need to install sphinx server first. for installation help click here. <br />To use sphinx search in rails we need to use either thinking sphinx gem or plugin that can be easily find on github. <br /><b>Plugin installation </b><br /><console>./script/plugin install  git://github.com/freelancing-god/thinking-sphinx.git </console><br />OR <br />To <b>install gem</b> run the following command. <br /><console>gem install thinking-sphinx &#8211;source http://rubygems.org/  If you&#8217;re upgrading, you should read this: http://freelancing-god.github.com/ts/en/upgrading.html  Successfully installed thinking-sphinx-1.3.16 1 gem installed </console>Edit environment file and add following lines to it inside initializer block. <br /><code>config.gem(      'thinking-sphinx',       :lib     =&gt; 'thinking_sphinx',       :version =&gt; '1.3.16'  ) </code>Edit Rakefile and add following lines to it. <code>require 'thinking_sphinx/tasks' </code>List rake task that should <b>show up sphinx related tasks. </b><br /><console>rake -T ts (in /home/sandip/v1) rake doc:plugins:acts_as_audited  # Generate documentation for the acts_as_&#8230; rake doc:plugins:acts_as_ferret   # Generate documentation for the acts_as_&#8230; rake rails:update:javascripts     # Update your javascripts from your curre&#8230; rake rails:update:scripts         # Add new scripts to the application scri&#8230; rake stats                        # Report code statistics (KLOCs, etc) fro&#8230; rake test:units                   # Run tests for unitsdb:test:prepare / Ru&#8230; rake tmp:sockets:clear            # Clears all files in tmp/sockets rake ts:conf                      # Generate the Sphinx configuration file &#8230; rake ts:config                    # Generate the Sphinx configuration file &#8230; rake ts:in                        # Index data for Sphinx using Thinking Sp&#8230; rake ts:rebuild                   # Stop Sphinx (if it&#8217;s running), rebuild &#8230; rake ts:reindex                   # Reindex Sphinx without regenerating the&#8230; rake ts:restart                   # Restart Sphinx / Restart Sphinx rake ts:run                       # Stop if running, then start a Sphinx se&#8230; rake ts:start                     # Start a Sphinx searchd daemon using Thi&#8230; rake ts:stop                      # Stop Sphinx using Thinking Sphinx&#8217;s set&#8230; rake ts:version                   # Output the current Thinking Sphinx vers&#8230; </console><b>Start sphinx server</b> this should give up an error.<br /><console>rake ts:start (in /home/sandip/v1) Failed to start searchd daemon. Check /home/sandip/v1/log/searchd.log. </console><b>Adding indexes in models</b><br /><code>define_index do      # following fields are database fields      # we can not add model methods in sphinx index       # sphinx fields allows ONLY model based associations      # fields       indexes customer_name       indexes phone       indexes mobile       indexes other_phone       indexes car_make       indexes car_model       indexes registration_no end </code><b>Configure sphinx </b><br /><console>rake ts:config Generating Configuration to /home/sandip/v1/config/development.sphinx.conf </console><b>Index sphinx</b><br /><console>rake ts:in (in /home/sandip/v1) Generating Configuration to /home/sandip/v1/config/development.sphinx.conf Sphinx 0.9.8-rc2 (r1234) Copyright (c) 2001-2008, Andrew Aksyonoff  using config file &#8216;/home/sandip/v1/config/development.sphinx.conf&#8217;&#8230; indexing index &#8216;call_core&#8217;&#8230; collected 113521 docs, 2.1 MB collected 0 attr values sorted 0.1 Mvalues, 100.0% done sorted 0.3 Mhits, 100.0% done total 113521 docs, 2114790 bytes total 6.102 sec, 346589.68 bytes/sec, 18604.78 docs/sec distributed index &#8216;call&#8217; can not be directly indexed; skipping. Generating Configuration to /home/sandip/v1/config/development.sphinx.conf Sphinx 0.9.8-rc2 (r1234) Copyright (c) 2001-2008, Andrew Aksyonoff  using config file &#8216;/home/sandip/v1/config/development.sphinx.conf&#8217;&#8230; indexing index &#8216;call_core&#8217;&#8230; collected 113521 docs, 2.1 MB collected 0 attr values sorted 0.1 Mvalues, 100.0% done sorted 0.3 Mhits, 100.0% done total 113521 docs, 2114790 bytes total 3.628 sec, 582909.70 bytes/sec, 31290.34 docs/sec distributed index &#8216;call&#8217; can not be directly indexed; skipping. </console><b>Search using sphinx</b><br /><console>./script console  &gt;&gt;Call.search &#8216;sandip&#8217; =&gt; [#<call 00:00:00"="" 09:22:35",="" 1018,="" 18:10:00",="" 2009-02-10="" 2009-03-27="" 2009-04-07="" 2009-11-18="" 20:29:06",="" 6,="" created_at:="" id:="" insurance_expiry_date:="" is="" is_existing_customer:="" nil,="" note:="" phone="" ringing",="" scheduled_at:="" state_id:="" station_shift_customer_car_insurance_product_id:="" updated_at:="">, #<call 00:00:00"="" 11:13:33",="" 18:30:00",="" 2009-02-10="" 2009-02-16="" 2009-04-03="" 2009-11-18="" 20:34:52",="" 6,="" 6024,="" call="" created",="" created_at:="" customer="" id:="" insurance_expiry_date:="" is_existing_customer:="" new="" nil,="" note:="" scheduled_at:="" state_id:="" station_shift_customer_car_insurance_product_id:="" updated_at:="">] </call></call></console><br />It returns array of records found. conditions are allowed by sphinx. If you need to add conditions on integer attributes then index block in model needs to have has method like author_id in following. <br /><code>define_index do   indexes content   indexes :name, :sortable =&gt; true   indexes comments.content, :as =&gt; :comment_content   indexes [author.first_name, author.last_name], :as =&gt; :author_name      has author_id, created_at end </code></div>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">sandipransing</span></span>

      








  


<time datetime="2010-04-12T19:07:00+05:30" pubdate data-updated="true">Apr 12<span>th</span>, 2010</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/rails/'>rails</a>, <a class='category' href='/blog/categories/thinking-sphinx/'>thinking sphinx</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://sandipransing.github.io/2010/04/using-thinking-sphinx-search-in-rails" data-via="sandipransing" data-counturl="http://sandipransing.github.io/2010/04/using-thinking-sphinx-search-in-rails" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2010/04/using-thinking-sphinx-with-rails" title="Previous Post: Using Thinking Sphinx with rails">&laquo; Using Thinking Sphinx with rails</a>
      
      
        <a class="basic-alignment right" href="/2010/04/using-modules-and-mixins-in-ruby" title="Next Post: using modules and mixins in ruby">using modules and mixins in ruby &raquo;</a>
      
    </p>
  </footer>
</article>


</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2014/02/migrating-from-blogger-to-octopress">Migrating from blogger to octopress</a>
      </li>
    
      <li class="post">
        <a href="/2014/02/writing-octopress-blog-posts-using-markdown">Writing Octopress blog posts using markdown</a>
      </li>
    
      <li class="post">
        <a href="/2014/02/octopress-powered-and-github-hosted-blog">Getting started: Octopress powered and Github hosted blog</a>
      </li>
    
      <li class="post">
        <a href="/2012/10/dynamic-conditions-to-rails-associations">Dynamic conditions to rails associations</a>
      </li>
    
      <li class="post">
        <a href="/2012/04/upgrading-from-rails-21x-to-rails-2311">Upgrading from Rails 2.1.x to Rails 2.3.11</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/sandipransing">@sandipransing</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'sandipransing',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - sandipransing -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> | Themed with <a href="https://github.com/lucaslew/whitespace">Whitespace</a></span>
</p>

</footer>
  








  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
