<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: thinking sphinx | Fun On Rails]]></title>
  <link href="http://funonrails.com/categories/thinking-sphinx/atom.xml" rel="self"/>
  <link href="http://funonrails.com/"/>
  <updated>2014-03-20T17:26:44+05:30</updated>
  <id>http://funonrails.com/</id>
  <author>
    <name><![CDATA[sandipransing]]></name>
    <email><![CDATA[sandip@funonrails.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[using thinking sphinx search in rails app]]></title>
    <link href="http://funonrails.com/2010/04/using-thinking-sphinx-search-in-rails/"/>
    <updated>2010-04-12T19:07:00+05:30</updated>
    <id>http://funonrails.com/2010/04/using-thinking-sphinx-search-in-rails</id>
    <content type="html"><![CDATA[<p>I am using <em>acts_as_ferret</em> and <em>ferret server</em> as of now with my rails application and it just works fine for me. The ONLY problem is <strong>performance</strong> as it takes a lot time to build index and to rebuild index when it gets screwed up and that&rsquo;s where <strong>sphinx rocks</strong>!</p>

<p>To get started with thinking sphinx you need to install sphinx server first. for installation help click here.</p>

<p>To use sphinx search in rails we need to use either thinking sphinx gem or plugin that can be easily find on github.</p>

<h2>Plugin installation</h2>

<p><code>
ruby script/plugin install  git://github.com/freelancing-god/thinking-sphinx.git
</code></p>

<h4>OR</h4>

<h2>Gem installation</h2>

<p>To install gem run the following command.
```
gem install thinking-sphinx &mdash;source <a href="http://rubygems.org/">http://rubygems.org/</a></p>

<p>If you&rsquo;re upgrading, you should read this:
<a href="http://freelancing-god.github.com/ts/en/upgrading.html">http://freelancing-god.github.com/ts/en/upgrading.html</a></p>

<p>Successfully installed thinking-sphinx-1.3.16
1 gem installed
```</p>

<p>Edit environment file and add following lines to it inside initializer block.
```
config.gem(</p>

<pre><code> 'thinking-sphinx',
  :lib     =&gt; 'thinking_sphinx',
  :version =&gt; '1.3.16'
</code></pre>

<p> )
```
Edit Rakefile and add following lines to it.</p>

<p><code>
require 'thinking_sphinx/tasks'
</code></p>

<p>List rake tasks that should show up sphinx related tasks.
<code>
rake -T ts
(in /home/sandip/v1)
rake doc:plugins:acts_as_audited  # Generate documentation for the acts_as_...
rake doc:plugins:acts_as_ferret   # Generate documentation for the acts_as_...
rake rails:update:javascripts     # Update your javascripts from your curre...
rake rails:update:scripts         # Add new scripts to the application scri...
rake stats                        # Report code statistics (KLOCs, etc) fro...
rake test:units                   # Run tests for unitsdb:test:prepare / Ru...
rake tmp:sockets:clear            # Clears all files in tmp/sockets
rake ts:conf                      # Generate the Sphinx configuration file ...
rake ts:config                    # Generate the Sphinx configuration file ...
rake ts:in                        # Index data for Sphinx using Thinking Sp...
rake ts:rebuild                   # Stop Sphinx (if it's running), rebuild ...
rake ts:reindex                   # Reindex Sphinx without regenerating the...
rake ts:restart                   # Restart Sphinx / Restart Sphinx
rake ts:run                       # Stop if running, then start a Sphinx se...
rake ts:start                     # Start a Sphinx searchd daemon using Thi...
rake ts:stop                      # Stop Sphinx using Thinking Sphinx's set...
rake ts:version                   # Output the current Thinking Sphinx vers...
</code></p>

<h2>Starting Sphinx</h2>

<p>Start sphinx server this should give up an error.
<code>
rake ts:start
(in /home/sandip/v1)
Failed to start searchd daemon. Check /home/sandip/v1/log/searchd.log.
</code></p>

<h2>Adding indexes in models</h2>

<p>```ruby
define_index do</p>

<pre><code> # following fields are database fields
 # we can not add model methods in sphinx index 
 # sphinx fields allows ONLY model based associations
 # fields
  indexes customer_name
  indexes phone
  indexes mobile
  indexes other_phone
  indexes car_make
  indexes car_model
  indexes registration_no
</code></pre>

<p>end
```</p>

<h2>Configure sphinx</h2>

<p>```
rake ts:config
Generating Configuration to /home/sandip/v1/config/development.sphinx.conf
Index sphinx</p>

<p>rake ts:in
(in /home/sandip/v1)
Generating Configuration to /home/sandip/v1/config/development.sphinx.conf
Sphinx 0.9.8-rc2 (r1234)
Copyright &copy; 2001-2008, Andrew Aksyonoff</p>

<p>using config file &lsquo;/home/sandip/v1/config/development.sphinx.conf&rsquo;&hellip;
indexing index &lsquo;call_core&rsquo;&hellip;
collected 113521 docs, 2.1 MB
collected 0 attr values
sorted 0.1 Mvalues, 100.0% done
sorted 0.3 Mhits, 100.0% done
total 113521 docs, 2114790 bytes
total 6.102 sec, 346589.68 bytes/sec, 18604.78 docs/sec
distributed index &lsquo;call&rsquo; can not be directly indexed; skipping.
Generating Configuration to /home/sandip/v1/config/development.sphinx.conf
Sphinx 0.9.8-rc2 (r1234)
Copyright &copy; 2001-2008, Andrew Aksyonoff</p>

<p>using config file &lsquo;/home/sandip/v1/config/development.sphinx.conf&rsquo;&hellip;
indexing index &lsquo;call_core&rsquo;&hellip;
collected 113521 docs, 2.1 MB
collected 0 attr values
sorted 0.1 Mvalues, 100.0% done
sorted 0.3 Mhits, 100.0% done
total 113521 docs, 2114790 bytes
total 3.628 sec, 582909.70 bytes/sec, 31290.34 docs/sec
distributed index &lsquo;call&rsquo; can not be directly indexed; skipping.
```</p>

<h2>Search using sphinx</h2>

<p>```ruby
ruby script console</p>

<blockquote><blockquote><p>Call.search &lsquo;sandip&rsquo;
=> [#<call 00:00:00"="" 09:22:35",="" 1018,="" 18:10:00",="" 2009-02-10="" 2009-03-27="" 2009-04-07="" 2009-11-18="" 20:29:06",="" 6,="" created_at:="" id:="" insurance_expiry_date:="" is="" is_existing_customer:="" nil,="" note:="" phone="" ringing",="" scheduled_at:="" state_id:="" station_shift_customer_car_insurance_product_id:="" updated_at:="">, #<call 00:00:00"="" 11:13:33",="" 18:30:00",="" 2009-02-10="" 2009-02-16="" 2009-04-03="" 2009-11-18="" 20:34:52",="" 6,="" 6024,="" call="" created",="" created_at:="" customer="" id:="" insurance_expiry_date:="" is_existing_customer:="" new="" nil,="" note:="" scheduled_at:="" state_id:="" station_shift_customer_car_insurance_product_id:="" updated_at:="">] </call></call>
<code>
It returns array of records found. conditions are allowed by sphinx. If you need to add conditions on integer attributes then index block in model needs to have has method like author_id in following.
</code>ruby
define_index do
  indexes content
  indexes :name, :sortable => true
  indexes comments.content, :as => :comment_content
  indexes [author.first_name, author.last_name], :as => :author_name</p></blockquote></blockquote>

<p>  has author_id, created_at
end
```</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Easy sphinx install on ubuntu interpid]]></title>
    <link href="http://funonrails.com/2009/08/easy-sphinx-install-on-ubuntu-interpid/"/>
    <updated>2009-08-17T13:02:00+05:30</updated>
    <id>http://funonrails.com/2009/08/easy-sphinx-install-on-ubuntu-interpid</id>
    <content type="html"><![CDATA[<h4>Download <code>sphinx source</code> from website</h4>

<p><code>
sudo apt-get install libmysqlclient15-dev
wget http://sphinxsearch.com/downloads/sphinx-0.9.8-rc2.tar.gz
</code></p>

<h4>Extract source code</h4>

<p><code>
tar xvf sphinx-0.9.8-rc2.tar.gz &amp;&amp; rm sphinx-0.9.8-rc2.tar.gz
</code></p>

<h4>Configure</h4>

<p><code>
cd sphinx-0.9.8-rc2
./configure
</code></p>

<h4>Install</h4>

<p><code>
make
sudo make install
</code></p>
]]></content>
  </entry>
  
</feed>
