---
layout: post
title: "nginx and thin installation and configuration"
date: 2010-03-26T02:59:00+05:30
comments: false
categories:
 - rails
 - nginx
 - passenger
---

<div class='post'>
<h3> Install nginx server using following command</h3><pre class=ruby>apt-get install nginx </pre>Edit nginx configuration and add server block inside html block.&amp;nbsp;<br /><pre class=ruby>server {<br />&nbsp;&nbsp; &nbsp;listen &nbsp; &nbsp; &nbsp; 80;<br />&nbsp;&nbsp; &nbsp;server_name &nbsp;boost;<br /><br />&nbsp;&nbsp; &nbsp;root /home/sandip/rails_app/public;<br /><br />&nbsp;&nbsp; &nbsp;location / {<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;proxy_set_header &nbsp;X-Real-IP &nbsp;$remote_addr;<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;proxy_set_header &nbsp;X-Forwarded-For $proxy_add_x_forwarded_for;<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;proxy_set_header Host $http_host;<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;proxy_redirect off;<br /><br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;if (-f $request_filename/index.html) {<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rewrite (.*) $1/index.html break;<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;}<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;if (-f $request_filename.html) {<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rewrite (.*) $1.html break;<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;}<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;if (!-f $request_filename) {<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;proxy_pass http://thin;<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;break;<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;}<br />&nbsp;&nbsp; &nbsp;}<br /><br />&nbsp;&nbsp; &nbsp;error_page &nbsp; 500 502 503 504 &nbsp;/50x.html;<br />&nbsp;&nbsp; &nbsp;location = /50x.html {<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;root &nbsp; html;<br />&nbsp;&nbsp; &nbsp;}<br />}<br /></pre><br />Install thin server as gem<br /><pre class=ruby>sudo gem install thin<br /><br />Building native extensions. &nbsp;This could take a while...<br />Building native extensions. &nbsp;This could take a while...<br />Successfully installed eventmachine-0.12.10<br />Successfully installed thin-1.2.7<br />2 gems installed<br /></pre><br />Install thin service<br /><pre class=ruby>sudo thin install<br />Installing thin service at /etc/init.d/thin ...<br />mkdir -p /etc/init.d<br />writing /etc/init.d/thin<br />chmod +x /etc/init.d/thin<br />mkdir -p /etc/thin<br /></pre><br />Configure thin to start at system boot<br /><pre class=ruby>sudo /usr/sbin/update-rc.d -f thin defaults<br /></pre><br />Then put your config files in /etc/thin<br /><pre class=ruby>sudo /usr/sbin/update-rc.d -f thin defaults<br />update-rc.d: warning: thin stop runlevel arguments (0 1 6) do not match LSB Default-Stop values (S 0 1 6)<br />&nbsp;Adding system startup for /etc/init.d/thin ...<br />&nbsp;&nbsp; /etc/rc0.d/K20thin -&amp;gt; ../init.d/thin<br />&nbsp;&nbsp; /etc/rc1.d/K20thin -&amp;gt; ../init.d/thin<br />&nbsp;&nbsp; /etc/rc6.d/K20thin -&amp;gt; ../init.d/thin<br />&nbsp;&nbsp; /etc/rc2.d/S20thin -&amp;gt; ../init.d/thin<br />&nbsp;&nbsp; /etc/rc3.d/S20thin -&amp;gt; ../init.d/thin<br />&nbsp;&nbsp; /etc/rc4.d/S20thin -&amp;gt; ../init.d/thin<br />&nbsp;&nbsp; /etc/rc5.d/S20thin -&amp;gt; ../init.d/thin<br /></pre><br />Create thin configuration<br /><pre class=ruby>sudo thin config -C /etc/thin/&lt;config-name&gt;.yml -c &lt;rails-app-root-path&gt; --servers &lt;number-of-threads&gt; -e &lt;environment&gt;<br />&lt;/environment&gt;&lt;/number-of-threads&gt;&lt;/rails-app-root-path&gt;&lt;/config-name&gt; </pre><br />In my case,<br /><pre class=ruby>sudo thin config -C /etc/thin/rails_app.yml -c /home/sandip/rails_app --servers 3 -e production<br />&amp;gt;&amp;gt; Wrote configuration to /etc/thin/rails_app.yml<br /></pre><br />thin configuration file will look like<br /><br />Start/stop/restart Nginx &amp;amp; thin server using command<br /><br /><pre class=ruby>sudo service nginx start|stop|restart<br />sudo service thin start|stop|restart<br /></pre></div>
